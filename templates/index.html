<!--
  Metadata Remote - Intelligent audio metadata editor
  Copyright (C) 2025 Dr. William Nelson Leonard
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.
  
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicMetaMgr</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div class="header">
        <div class="theme-toggle-wrapper">
            <label class="theme-toggle" for="theme-switch" title="Toggle theme (Alt+T)" aria-label="Theme toggle" aria-keyshortcuts="Alt+T">
                <input type="checkbox" id="theme-switch" class="theme-switch-checkbox" aria-checked="false">
                <span class="theme-switch-slider">
                    <span class="theme-icon moon">‚òΩ</span>
                    <span class="theme-icon sun">‚òº</span>
                </span>
            </label>
        </div>
        <h1 style="margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; height: 1.5rem;">
            <a href="https://www.thelifeyoucansave.org" target="_blank" rel="noopener noreferrer" style="display: inline;">
                <img id="app-logo" src="{{ url_for('static', filename='mdrm-logo-dark-theme.png') }}" alt="metadata remote" style="height: 1rem; width: auto;">
            </a>
        </h1>
        <button class="help-button" id="help-button" title="Show keyboard shortcuts" tabindex="0"><b>?</b></button>
    </div>
    
    <div class="container">
        <div class="folders" tabindex="0" id="folders-pane">
            <div class="pane-header">
                <span>Folderes <span class="file-count" id="folder-count">(0)</span></span>
                <div class="icon-controls">
                    <button class="control-icon" id="folders-filter-btn" title="Filter folders (/)" tabindex="0">
                        üîç
                    </button>
                    <div class="sort-controls">
                        <button class="control-icon sort-field-btn" id="folders-sort-btn" title="Sort by: Name" tabindex="0">
                            ‚ÜïÔ∏è
                        </button>
                        <button class="control-icon sort-direction-btn" id="folders-sort-direction" title="Click to reverse order" tabindex="0">
                            <span class="sort-indicator" id="folders-sort-indicator">‚ñ≤</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="filter-container" id="folders-filter">
                <input type="text" class="filter-input" placeholder="Filter folders..." id="folders-filter-input">
            </div>
            <div class="sort-dropdown" id="folders-sort-dropdown">
                <div class="sort-option active" data-sort="name">Name</div>
                <div class="sort-option" data-sort="date">Date Modified</div>
                <div class="sort-option" data-sort="size">Size</div>
            </div>
            <div class="folders-scroll-area">
                <div id="folder-tree" class="tree"></div>
            </div>
        </div>
        
        <div class="divider" id="divider1"></div>

        <div class="files" tabindex="0" id="files-pane">
            <div class="pane-header">
                <span>Files <span class="file-count" id="file-count">(0)</span></span>
                <div class="icon-controls">
                    <button class="control-icon" id="files-filter-btn" title="Filter files (/)" tabindex="0">
                        üîç
                    </button>
                    <div class="sort-controls">
                        <button class="control-icon sort-field-btn" id="files-sort-btn" title="Sort by: Name" tabindex="0">
                            ‚ÜïÔ∏è
                        </button>
                        <button class="control-icon sort-direction-btn" id="files-sort-direction" title="Click to reverse order" tabindex="0">
                            <span class="sort-indicator" id="files-sort-indicator">‚ñ≤</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="filter-container" id="files-filter">
                <input type="text" class="filter-input" placeholder="Filter files..." id="files-filter-input">
            </div>
            <div class="sort-dropdown" id="files-sort-dropdown">
                <div class="sort-option active" data-sort="name">Name</div>
                <div class="sort-option" data-sort="date">Date Modified</div>
                <div class="sort-option" data-sort="type">Type</div>
                <div class="sort-option" data-sort="size">Size</div>
            </div>
            <div class="files-scroll-area">
                <ul id="file-list"></ul>
            </div>
        </div>
        
        <div class="divider" id="divider2"></div>
        
        <div class="metadata">
            <div class="metadata-content">
                <div id="no-file-message" class="no-file-selected">
                    Select a file to edit its metadata
                </div>
                
                <div id="metadata-section" style="display: none;">
                    <h3>Metadata for: <span id="current-filename" class="filename-display" tabindex="0"></span></h3>
                    
                    <div class="filename-edit">
                        <input type="text" id="filename-input" placeholder="Enter new filename">
                        <button class="filename-save btn-status" onclick="saveFilename()">
                            <span class="btn-status-content">Save</span>
                            <span class="btn-status-message"></span>
                        </button>
                        <button class="filename-reset" onclick="resetFilename()">Reset</button>
                        <button class="filename-cancel" onclick="cancelFilenameEdit()">‚úï</button>
                    </div>
                    
                    <div id="metadata-loading-indicator" class="metadata-loading-indicator" style="display: none;">
                        <div class="loading-spinner-container">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Loading metadata...</div>
                        </div>
                    </div>
                    
                    <div id="metadata-content-wrapper">
                    
                    <!-- Clipboard controls -->
                    <div class="clipboard-controls">
                        <button type="button" class="clipboard-btn copy-metadata-btn" onclick="window.MetadataRemote.Metadata.Clipboard.copyFromCurrentFile()" title="Copy all metadata from this file (Ctrl+C)">
                            <span class="btn-icon">üìã</span>
                            <span class="btn-text">Copy</span>
                        </button>
                        <button type="button" class="clipboard-btn paste-metadata-btn" onclick="window.MetadataRemote.Metadata.Clipboard.openPasteModal()" title="Paste metadata (Ctrl+V)" disabled>
                            <span class="btn-icon">üì•</span>
                            <span class="btn-text">Paste</span>
                        </button>
                        <div class="clipboard-indicator" id="clipboard-indicator" style="display: none;">
                            <span class="clipboard-icon">üìé</span>
                            <span class="clipboard-count">0</span>
                            <span class="clipboard-label">from</span>
                            <span class="clipboard-source" title="Source file"></span>
                            <button type="button" class="clipboard-clear" onclick="window.MetadataRemote.Metadata.Clipboard.clearClipboard()" title="Clear clipboard">‚úï</button>
                        </div>
                    </div>
                    
                    <div class="album-art-section">
                        <div class="album-art-container">
                            <div id="art-display">
                                <div class="album-art-placeholder">No album art</div>
                            </div>
                            <div class="album-art-controls">
                                <button class="upload-btn" onclick="document.getElementById('art-upload').click()">Upload</button>
                                <button class="save-image-btn btn-status" onclick="saveAlbumArt()" style="display: none;">
                                    <span class="btn-status-content">Apply to file</span>
                                    <span class="btn-status-message"></span>
                                </button>
                                <button class="apply-folder-btn btn-status" onclick="applyArtToFolder()" style="display: none;">
                                    <span class="btn-status-content">Apply to folder</span>
                                    <span class="btn-status-message"></span>
                                </button>
                                <button class="delete-art-btn btn-status" onclick="deleteAlbumArt()" style="display: none;">
                                    <span class="btn-status-content">Delete</span>
                                    <span class="btn-status-message"></span>
                                </button>
                                <input type="file" id="art-upload" accept="image/*" onchange="handleArtUpload(event)">
                            </div>
                        </div>
                    </div>
                    
                    <form id="metadata-form">
                        <!-- Standard fields will be dynamically rendered here -->
                        <div id="standard-fields-container"></div>
                        
                        <!-- Consolidated apply controls for Track #, Disc #, and Year -->
                        <div class="grouped-apply-controls" id="grouped-apply-controls" style="display: none;">
                            <div class="grouped-apply-header">
                                <span class="grouped-apply-title">Apply changes:</span>
                            </div>
                            <div class="grouped-apply-items" id="grouped-apply-items">
                                <!-- Grouped field controls will be dynamically rendered here -->
                            </div>
                        </div>
                        
                    </form>
                    
                    <!-- Extended fields toggle -->
                    <div class="extended-fields-toggle" tabindex="0" role="button" aria-expanded="false" aria-controls="extended-fields-wrapper" onclick="window.MetadataRemote.Metadata.Editor.toggleExtendedFields()">
                        <span class="expand-icon">‚ñ∂</span>
                        <span>Extended metadata fields</span>
                    </div>
                    
                    <!-- Container for extended fields -->
                    <div id="extended-fields-wrapper" style="display: none;">
                        <div id="dynamic-fields-container"></div>
                    </div>
                    
                    <!-- Filename suggestions section -->
                    <div id="filename-suggestions-section" style="display: none;">
                        <div class="filename-suggestions-header">Suggestions from filename:</div>
                        <div id="filename-suggestions-container" class="filename-suggestions-list"></div>
                    </div>
                    
                    <!-- Common fields quick-add section -->
                    <div id="common-fields-section" style="display: none;">
                        <div class="common-fields-header">Quick add fields:</div>
                        <div id="common-fields-container" class="common-fields-badges"></div>
                    </div>
                    
                    <!-- Folder fields suggestions toggle -->
                    <div class="folder-fields-toggle" tabindex="0" role="button" aria-expanded="false" aria-controls="folder-fields-wrapper" style="display: none;">
                        <span class="expand-icon">‚ñ∂</span>
                        <span>Fields from other files in folder</span>
                    </div>
                    
                    <!-- Container for folder field suggestions -->
                    <div id="folder-fields-wrapper" style="display: none;">
                        <div id="folder-fields-container"></div>
                    </div>
                    
                    <!-- Add new metadata field section -->
                    <div class="new-field-header" tabindex="0" role="button" aria-expanded="false" aria-controls="new-field-form" onclick="window.MetadataRemote.Metadata.Editor.toggleNewFieldForm()">
                        <span class="expand-icon">‚ñ∂</span>
                        <span>Add new metadata field</span>
                    </div>
                    <div class="new-field-form" id="new-field-form" style="display: none;">
                        <div class="form-group">
                            <label for="new-field-name">Field name</label>
                            <input type="text" 
                                   id="new-field-name" 
                                   placeholder="e.g., RATING, MOOD"
                                   pattern="[A-Za-z0-9_]+"
                                   title="Only letters, numbers, and underscores allowed"
                                   maxlength="50">
                        </div>
                        <div class="form-group">
                            <label for="new-field-value">Content</label>
                            <input type="text" 
                                   id="new-field-value" 
                                   placeholder="Enter initial value">
                        </div>
                        <div class="new-field-actions">
                            <button type="button" 
                                    class="btn btn-primary" 
                                    onclick="window.MetadataRemote.Metadata.Editor.createNewField(false)">
                                Save to File
                            </button>
                            <button type="button" 
                                    class="btn btn-secondary" 
                                    onclick="window.MetadataRemote.Metadata.Editor.createNewField(true)">
                                Save to Folder
                            </button>
                            <button type="button" 
                                    class="btn btn-cancel" 
                                    onclick="window.MetadataRemote.Metadata.Editor.cancelNewField()">
                                Cancel
                            </button>
                        </div>
                    </div>
                    
                    <!-- Save and Reset buttons at the bottom -->
                    <div class="buttons">
                        <button type="button" class="save-btn btn-status" onclick="save()">
                            <span class="btn-status-content">Save all fields to file</span>
                            <span class="btn-status-message"></span>
                        </button>
                        <button type="button" class="clear-btn btn-status" onclick="resetForm()">
                            <span class="btn-status-content">Reset</span>
                            <span class="btn-status-message"></span>
                        </button>
                    </div>
                    
                    <div id="status" class="status"></div>
                    
                    <!-- Audio Player Bar -->
                    <div class="audio-player-bar" id="audio-player-bar">
                        <div class="player-track-info">
                            <span class="player-track-name" id="player-track-name">No track playing</span>
                        </div>
                        <div class="player-controls">
                            <button class="player-btn player-prev" id="player-prev" title="Previous track">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                                </svg>
                            </button>
                            <button class="player-btn player-play-pause" id="player-play-pause" title="Play/Pause">
                                <svg class="play-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                                <svg class="pause-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                </svg>
                            </button>
                            <button class="player-btn player-next" id="player-next" title="Next track">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="player-progress-container">
                            <span class="player-time player-current-time" id="player-current-time">0:00</span>
                            <input type="range" class="player-progress" id="player-progress" min="0" max="100" value="0" step="0.1">
                            <span class="player-time player-duration" id="player-duration">0:00</span>
                        </div>
                        <div class="player-volume-container">
                            <button class="player-btn player-volume-btn" id="player-volume-btn" title="Mute/Unmute">
                                <svg class="volume-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                                </svg>
                                <svg class="volume-muted-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                                    <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                                </svg>
                            </button>
                            <input type="range" class="player-volume" id="player-volume" min="0" max="100" value="100" step="1">
                        </div>
                    </div>
                    </div>
                </div>
            </div>
            
            <!-- Editing History Panel -->
            <div class="history-panel collapsed" id="history-panel">
                <div class="history-header">
                    <div class="history-title">
                        <span>Editing History</span>
                        <span class="history-toggle">‚ñ≤</span>
                    </div>
                    <button class="history-clear-btn" onclick="clearHistory()" title="Clear all history">
                        <span class="clear-text">Clear History</span>
                    </button>
                </div>
                <div class="history-content">
                    <div class="history-list" id="history-list">
                        <div class="history-loading">Loading history...</div>
                    </div>
                    <div class="divider history-divider" id="history-divider"></div>
                    <div class="history-details" id="history-details">
                        <div class="history-details-empty">Select an action to view details</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden audio player -->
    <audio id="audio-player"></audio>

    <!-- Help Box Modal -->
    <div class="help-overlay" id="help-overlay"></div>
    <div class="help-box" id="help-box">
        <button class="help-close" id="help-close">‚úï</button>
        
        <div class="help-app-name">
            <h2>Metadata Remote (mdrm) v1.2.0</h2>
        </div>
        
        <div class="help-content">
            <div class="help-sections-grid">
                <div class="help-section">
                    <h3 class="help-section-title">Navigation</h3>
                    <div class="help-shortcut-list">
                        <div class="help-shortcut-item">
                            <span class="help-description">Navigate items</span>
                            <span class="help-keys"><span class="help-key">‚Üë</span><span class="help-key">‚Üì</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Jump pages</span>
                            <span class="help-keys"><span class="help-key">PgUp</span><span class="help-key">PgDn</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Expand / Load</span>
                            <span class="help-keys"><span class="help-key">Enter</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Switch panes</span>
                            <span class="help-keys"><span class="help-key">Tab</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3 class="help-section-title">Playback</h3>
                    <div class="help-shortcut-list">
                        <div class="help-shortcut-item">
                            <span class="help-description">Play / Pause</span>
                            <span class="help-keys"><span class="help-key">Space</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Play file</span>
                            <span class="help-keys"><span class="help-key">Enter</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Seek ¬±5s</span>
                            <span class="help-keys"><span class="help-key">Shift</span>+<span class="help-key">‚Üê</span><span class="help-key">‚Üí</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3 class="help-section-title">Editing</h3>
                    <div class="help-shortcut-list">
                        <div class="help-shortcut-item">
                            <span class="help-description">Edit field</span>
                            <span class="help-keys"><span class="help-key">Enter</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Exit edit</span>
                            <span class="help-keys"><span class="help-key">Enter</span> / <span class="help-key">Esc</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Delete field</span>
                            <span class="help-keys"><span class="help-key">Shift</span>+<span class="help-key">Delete</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Copy metadata</span>
                            <span class="help-keys"><span class="help-key">Ctrl</span><span class="help-key-plus">+</span><span class="help-key">C</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Paste metadata</span>
                            <span class="help-keys"><span class="help-key">Ctrl</span><span class="help-key-plus">+</span><span class="help-key">V</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3 class="help-section-title">Sorting</h3>
                    <div class="help-shortcut-list">
                        <div class="help-shortcut-item">
                            <span class="help-description">Reverse sort</span>
                            <span class="help-keys"><span class="help-key">Ctrl</span><span class="help-key-plus">+</span><span class="help-key">Shift</span><span class="help-key-plus">+</span><span class="help-key">S</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3 class="help-section-title">General</h3>
                    <div class="help-shortcut-list">
                        <div class="help-shortcut-item">
                            <span class="help-description">Cancel / Close</span>
                            <span class="help-keys"><span class="help-key">Esc</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Toggle theme</span>
                            <span class="help-keys"><span class="help-key">Alt</span><span class="help-key-plus">+</span><span class="help-key">T</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3 class="help-section-title">Renaming</h3>
                    <div class="help-shortcut-list">
                        <div class="help-shortcut-item">
                            <span class="help-description">Rename file</span>
                            <span class="help-keys"><span class="help-key">‚Üë</span>  to name ‚Üí <span class="help-key">Enter</span></span>
                        </div>
                        <div class="help-shortcut-item">
                            <span class="help-description">Rename folder</span>
                            <span class="help-keys"><span class="help-key">Enter</span><span class="help-key">Enter</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="help-footer">
            <div class="help-copyright">¬© 2025 Dr. William Nelson Leonard</div>
            <a href="https://github.com/hareeshbabu82ns/metadata-remote" target="_blank" class="help-github-link">View on GitHub</a>
        </div>
    </div>

    <!-- Field Edit Modal -->
    <div class="field-edit-overlay" id="field-edit-overlay" role="presentation"></div>
    <div class="field-edit-box" id="field-edit-box" role="dialog" aria-modal="true" aria-labelledby="field-edit-header">
        <div class="field-edit-header" id="field-edit-header">
            <span id="field-edit-filename" class="field-edit-filename"></span>: 
            <span id="field-edit-fieldname" class="field-edit-fieldname"></span>
        </div>
        
        <div class="field-edit-content">
            <textarea 
                id="field-edit-textarea"
                class="field-edit-textarea"
                placeholder="Enter field content..."
                spellcheck="false"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                aria-label="Field content editor"
            ></textarea>
        </div>
        
        <div class="field-edit-actions">
            <button class="field-edit-btn field-edit-apply-file btn-status" id="field-edit-apply-file" disabled aria-label="Apply changes to current file">
                <span class="btn-status-content">Apply to file</span>
                <span class="btn-status-message"></span>
            </button>
            <button class="field-edit-btn field-edit-apply-folder btn-status" id="field-edit-apply-folder" disabled aria-label="Apply changes to all files in folder">
                <span class="btn-status-content">Apply to folder</span>
                <span class="btn-status-message"></span>
            </button>
            <button class="field-edit-btn field-edit-reset" id="field-edit-reset" aria-label="Reset to original content">
                Reset
            </button>
            <button class="field-edit-btn field-edit-cancel" id="field-edit-cancel" aria-label="Cancel and close">
                Cancel
            </button>
        </div>
    </div>

    <!-- Paste Modal -->
    <div class="paste-modal-overlay" id="paste-modal-overlay" role="presentation"></div>
    <div class="paste-modal" id="paste-modal" role="dialog" aria-modal="true" aria-labelledby="paste-modal-header">
        <div class="paste-modal-header" id="paste-modal-header">
            <h3>Paste Metadata</h3>
            <span class="paste-source-info" id="paste-source-info"></span>
        </div>
        
        <div class="paste-modal-content">
            <div class="paste-select-controls">
                <button type="button" class="paste-select-btn" onclick="window.MetadataRemote.Metadata.Clipboard.toggleAllPasteFields(true)">Select All</button>
                <button type="button" class="paste-select-btn" onclick="window.MetadataRemote.Metadata.Clipboard.toggleAllPasteFields(false)">Deselect All</button>
            </div>
            <div class="paste-fields-list" id="paste-fields-list">
                <!-- Field checkboxes will be dynamically inserted here -->
            </div>
        </div>
        
        <div class="paste-modal-actions">
            <button type="button" class="paste-action-btn paste-to-file" id="paste-to-file-btn" onclick="window.MetadataRemote.Metadata.Clipboard.pasteToFile()">
                Paste to File
            </button>
            <button type="button" class="paste-action-btn paste-to-folder" id="paste-to-folder-btn" onclick="window.MetadataRemote.Metadata.Clipboard.pasteToFolder()">
                Paste to Folder
            </button>
            <button type="button" class="paste-action-btn paste-cancel" onclick="window.MetadataRemote.Metadata.Clipboard.closePasteModal()">
                Cancel
            </button>
        </div>
    </div>
  
    <!-- Core modules -->
    <script src="{{ url_for('static', filename='js/state.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>

    <!-- UI modules -->
    <script src="{{ url_for('static', filename='js/ui/button-status.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui/utilities.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui/pane-resize.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui/filter-sort.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui/theme-toggle.js') }}"></script>

    <!-- Audio modules -->
    <script src="{{ url_for('static', filename='js/audio/player.js') }}"></script>

    <!-- Navigation modules -->
    <script src="{{ url_for('static', filename='js/navigation/tree.js') }}"></script>
    
    <!-- Navigation utilities -->
    <script src="{{ url_for('static', filename='js/navigation/keyboard-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navigation/focus-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navigation/state-machine.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navigation/router.js') }}"></script>
    
    <!-- Navigation contexts -->
    <script src="{{ url_for('static', filename='js/navigation/contexts/pane-navigation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navigation/contexts/header-navigation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navigation/contexts/list-navigation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navigation/contexts/form-navigation.js') }}"></script>
    
    <script src="{{ url_for('static', filename='js/navigation/keyboard.js') }}"></script>

    <!-- Files modules -->
    <script src="{{ url_for('static', filename='js/files/manager.js') }}"></script>

    <!-- Metadata modules -->
    <script src="{{ url_for('static', filename='js/metadata/editor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/metadata/album-art.js') }}"></script>
    <script src="{{ url_for('static', filename='js/metadata/inference.js') }}"></script>
    <script src="{{ url_for('static', filename='js/metadata/transition-controller.js') }}"></script>
    <script src="{{ url_for('static', filename='js/metadata/field-edit-modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/metadata/clipboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/metadata/folder-fields.js') }}"></script>

    <!-- History modules -->
    <script src="{{ url_for('static', filename='js/history/manager.js') }}"></script>
  
    <!-- Main application -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
